{% extends "base.html" %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h3>Livros</h3>
  <div>
    <a class="btn btn-sm btn-success" href="{{ url_for('books.create_book') }}">Novo livro</a>
  </div>
</div>
<form class="mb-3" method="get">
  <div class="input-group">
    <input name="q" class="form-control" placeholder="Pesquisar por título, autor ou categoria..." value="{{ q }}">
    <button class="btn btn-outline-secondary">Pesquisar</button>
  </div>
</form>
<table class="table table-hover">
  <thead><tr><th>#</th><th>Título</th><th>Autores</th><th>Qtd</th><th>Ações</th></tr></thead>
  <tbody>
    {% for book in pag.items %}
    <tr>
      <td>{{ book.id }}</td>
      <td>{{ book.titulo }}</td>
      <td>{{ book.autores }}</td>
      <td>{{ book.quantidade }}</td>
      <td>
        {% if current_user.is_authenticated and current_user.role.name in ("BIBLIOTECARIO", "ADMIN") %}
          <a href="{{ url_for('books.edit_book', id=book.id) }}" class="btn btn-warning btn-sm">Editar</a>
          <form action="{{ url_for('books.delete_book', id=book.id) }}" method="POST" onsubmit="return confirm('Tem certeza que deseja excluir este livro?');" style="display:inline;">
              <button type="submit" class="btn btn-danger btn-sm">Excluir</button>
          </form>
        {% endif %}

        {# botão de solicitação para usuários comuns #}
        {% if current_user.is_authenticated and current_user.role.name == "USUARIO" %}
          <a class="btn btn-primary btn-sm" href="{{ url_for('loans.request_loan', book_id=book.id) }}">Solicitar</a>
        {% endif %}
      </td>
      <td>
        {% if book.quantidade == 0 %}
            <span class="text-danger">Indisponível</span>
        {% else %}
            <span class="text-success">Disponível</span>
        {% endif %}
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
